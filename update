#!/bin/bash

set -e
android_home=/data/home/root
android_tmp=/data/tmp
dir=${android_home}/soccervision
binary=${android_source}/out/target/product/hammerhead/obj/EXECUTABLES/soccervision_intermediates/LINKED/soccervision

function echogreen {
  echo -e "\e[1;32m${1}\e[0m"
}

function soccervision_exists {
  if android_cmd "ls -d ${dir} 2>&1" | grep 'No such file or directory' >/dev/null; then
    return 1
  fi
  return 0
}

function soccervision_copy {
  echogreen 'Creating soccervision structure on Android...'
  local tmpdir=$(hometemp -d)
  mkdir ${tmpdir}/soccervision
  cp -r config screenshots sv ${tmpdir}/soccervision
  android_copy ${tmpdir}/soccervision android:${android_home}
  rm -r ${tmpdir}
}

function ensure_soccervision_exists {
  if ! soccervision_exists ; then
    soccervision_copy
  fi
}

echogreen "Building..."
./build
echogreen "Connecting to Android..."
ensure_soccervision_exists
echogreen "Uploading soccervision..."
android_copy ${binary} android:${android_home}/soccervision

